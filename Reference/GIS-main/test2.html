<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no" />
    <title>美国自然灾害分布</title>

    <style>
        html,
        body,
        body {

            overflow: hidden;
        }
        #scale{
            left: 2%;
            bottom: 4%;
            height: 3%;
            width:15%;
            font-size: 12px;
            position: absolute;
        }

        #viewDiv {
            top: 0;
            padding: 0;
            margin: 0;
            height: 100%;
            float:left;
            width: 45%;
        }
        #viewbox {
            position: relative;
            top: 0;
            padding: 0;
            margin: 0;
            height: 100%;
            /*float:left;*/
            width: 45%;
            left: 45%;
            /*background-color: red;*/
        }

        #viewDiv3 {
            position: absolute;
            padding: 0;
            margin: 0;
            height: 100%;
            width: 100%;
            /*left: 45%;*/
        }
        #viewDiv2 {
            position: absolute;
            padding: 0;
            margin: 0;
            height: 100%;
            width: 100%;
            /*left: 45%;*/
        }

        /*#viewDiv3 {*/
        /*    top: 0;*/
        /*    padding: 0;*/
        /*    margin: 0;*/
        /*    height: 100%;*/
        /*    width: 45%;*/
        /*    left: 45%;*/
        /*}*/
        /*#viewDiv2 {*/
        /*    top: 0;*/
        /*    padding: 0;*/
        /*    margin: 0;*/
        /*    height: 100%;*/
        /*    width: 100%;*/
        /*}*/
        /*#viewDiv3 {*/
        /*    top: 0;*/
        /*    padding: 0;*/
        /*    margin: 0;*/
        /*    height: 100%;*/
        /*    width: 100%;*/
        /*}*/
        #basemap1{
            height: 27%;
            width: 100%;
            top: 0;
        }
        .basebutton1{
            width: 100%;
            height: 6%;
            text-align: center;
            top: 27%;
            position: absolute;
        }
        .basebutton2{
            width: 100%;
            height: 6%;
            text-align: center;
            top: 60%;
            position: absolute;
        }
        .basebutton3{
            width: 100%;
            height: 7%;
            text-align: center;
            top: 93%;
            position: absolute;
        }
        #basemap2{
            height: 27%;
            width: 100%;
            top: 33%;
            position: absolute;
        }
        #basemap3{
            height: 27%;
            width: 100%;
            top: 66%;
            position: absolute;
        }
        #bmap{
            height: 50%;
            width: 10%;
            position: absolute;
            right: 0;
            top: 0;
            border-width: 2px ;
            border-color: darkgray;
            border-style: groove;

        }
        #LayerBox{
            height: 25%;
            width: 10%;
            position: absolute;
            right: 0;
            top: 50%;
            border-width: 2px ;
            border-color: darkgray;
            border-style: groove;
            text-align: center;
            float: left;

        }
        #smallbox{
            float: left;
            margin-top: 20px;
            margin-left: 20px;
        }
        .add{
            margin-left: 5px;
            float: left;
            background-color: white;
            border: 1px solid ;
            height: 20px;
            width: 20px;
        }
        .remove{
            margin-left: 5px;
            float: left;
            position:initial;
            background-color: white;
            border: 1px solid ;
            height: 20px;
            width: 20px;
            text-align: center;
        }

        #Layers{
            margin-left: 5px;
            float: left;
            color: dimgray;
            position:initial;
        }
        #test{
            height: 25%;
            width: 10%;
            position: absolute;
            right: 0;
            top: 75%;
            border-width: 2px ;
            border-color: darkgray;
            border-style: groove;
        }
    </style>

    <link rel="stylesheet" href="https://js.arcgis.com/4.19/esri/themes/light/main.css">
    <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.3.1/css/bootstrap.min.css">
    <script src="https://cdn.staticfile.org/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdn.staticfile.org/popper.js/1.15.0/umd/popper.min.js"></script>
    <script src="https://cdn.staticfile.org/twitter-bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="https://cdn.staticfile.org/echarts/4.3.0/echarts.min.js"></script>
    <script src="https://js.arcgis.com/4.19/"></script>




</head>
<body>
<div id="LayerBox">
    根据地质学家的研究表明，包括洛杉矶、旧金山等加州众多大城市，均坐落在著名的“圣安德列斯断层”上,也是目前地球上地层活动最频繁的区域
<!--    <p>添加图层</p>-->
<!--    <div id = "smallbox">-->
<!--        <a>地震</a>-->
<!--        <button id = "addlayer1" class = "add"></button>-->
<!--        <button id = "removelayer1" class="remove"></button>-->
<!--    </div>-->
<!--    <div id = "smallbox">-->
<!--        <a>火灾</a>-->
<!--        <button id = "addlayer2" class = "add"></button>-->
<!--        <button id = "removelayer2" class="remove"></button>-->
<!--    </div>-->
<!--    <div id = "smallbox">-->
<!--        <a>飓风</a>-->
<!--        <button id = "addlayer3" class = "add"></button>-->
<!--        <button id = "removelayer3" class="remove"></button>-->
    </div>
    <div id = "Layers" class="111"></div>
<!--    <input type="range" id="range1" min="0" max="100" step="5" onchange="b.value=this.value"/>-->
<!--    <output id="b" for="range1" ></output>-->
</div>
<div id="viewDiv">
    <div id ="scale"></div>
</div>
<div id="viewbox">
    <div id="viewDiv2"></div>
    <div id="viewDiv3"></div>
</div>



<div id="bmap">
<!--    <div id ="basemap1"></div>-->
<!--    <div id ="basemap2"></div>-->
<!--    <div id ="basemap3"></div>-->
<!--    <input type="button" class="basebutton1" onclick="bmap1()" value="streets-vector"></input>-->
<!--    <input type="button" class="basebutton2" onclick="bmap2()" value="arcgis-navigation"></input>-->
<!--    <input type="button" class="basebutton3" onclick="bmap3()" value="national-geographic"></input>-->
</div>
<div id = "test">
    加州地区的强震次数逐年递增，特别是此次发生连续两次6级以上强震之外，在数天之内，美国地震部门已经检测统计到4700多次余震，几乎达到了每分钟一次
</div>
<script type="text/javascript">
    var myChart = echarts.init(document.getElementById('bmap'));

    // 指定图表的配置项和数据
    var option = {
        tooltip: {},
        legend: {
            data:['重大地震次数']
        },
        xAxis: {
            data: ["00-10年","10-20年"]
        },
        yAxis: {
        },
        series: [{
            name: '重大地震次数',
            type: 'bar',
            data: [11, 12]
        }]
    };

    // 使用刚指定的配置项和数据显示图表。
    myChart.setOption(option);
</script>
<script>
    var view;
    function bmap1() {
        view.map.basemap = "streets-vector"
    }
    function bmap2() {
        view.map.basemap = "arcgis-navigation"
    }
    function bmap3() {
        view.map.basemap = "national-geographic"
    }
    require(["esri/config",
            "esri/Map",
            "esri/views/MapView",
            "esri/layers/MapImageLayer",
            "esri/layers/FeatureLayer",
            "esri/tasks/QueryTask",
            "esri/tasks/support/Query",
            "esri/symbols/SimpleFillSymbol",
            "esri/layers/GeoJSONLayer",
            "esri/PopupTemplate",
            "esri/widgets/LayerList"
        ],
        function (esriConfig,Map, MapView,MapImageLayer,FeatureLayer,QueryTask,Query,SimpleFillSymbol,GeoJSONLayer,PopupTemplate,LayerList) {

        esriConfig.apiKey = "AAPK5ce0ba9ea0c841969eaa47073f781ef0JMjXDugo--X8Phg7r-YcdAI_q7bcj2LGBQL8psjx6NEXBJEkwxSd3BtU8bD6Uy7L";

        const map = new Map({
            basemap: "arcgis-topographic"// Basemap layer service
            //hybrid，streets-vector
        });
        const map1 = new Map({
            basemap: "streets-vector"// Basemap layer service
            //hybrid，streets-vector
        });
        const map2 = new Map({
            basemap: "arcgis-navigation"// Basemap layer service
            //hybrid，streets-vector
        });
        const map3 = new Map({
            basemap: "hybrid"// Basemap layer service
            //hybrid，streets-vector
        });
        const map4 = new Map({
            basemap: "national-geographic"// Basemap layer service
            //hybrid，streets-vector
        });
        view = new MapView({
            map: map,
            center: [-100,40], // Longitude, latitude
            zoom: 4, // Zoom level
            container: "viewDiv" // Div element
        });

        view2 = new MapView({
            map: map3,
            center: [-100,40], // Longitude, latitude
            zoom: 4, // Zoom level
            container: "viewDiv2" // Div element
        });

        view3 = new MapView({
            map: map,
            center: [-100,40], // Longitude, latitude
            zoom: 4, // Zoom level
            container: "viewDiv3" // Div element
        });
        let layerList = new LayerList({
                view: view
            });
        view.ui.add(layerList, {
                position: "top-right"
            });
        view2.ui.components=[];
        view3.ui.components=[];
        var extent=null;
        //监听滚轮事件
        view.on("mouse-wheel",function(){
            window.setTimeout(function() {
                extent = view.extent;
                view2.extent = extent;
                view3.extent = extent;
            })
        });
        view2.on("mouse-wheel",function(){
            window.setTimeout(function() {
                extent = view2.extent;
                view.extent = extent;
                view3.extent= extent;
            })
        });
        view3.on("mouse-wheel",function(){
            window.setTimeout(function() {
                extent = view3.extent;
                view.extent = extent;
                view2.extent= extent;
            })
        });
        view.on(["pointer-down","pointer-move"], function() {
            LinkMap02();
        });
        function LinkMap02() {
            view2.zoom=view.zoom;
            view2.center=view.center;
            view3.zoom=view.zoom;
            view3.center=view.center;
        }
        //监听鼠标拖移事件
        view.on("drag",function () {
            extent=view.extent;
            view2.extent=extent;
            view3.extent=extent;
        });
        view2.on("drag",function () {
            extent=view2.extent;
            view.extent=extent;
            view3.extent=extent;
        });
        view3.on("drag",function () {
            extent=view3.extent;
            view.extent=extent;
            view2.extent=extent;
        });

        view.on("click", function(ev) {
            alert("地震（英文：earthquake），又称地动、地振动，是地壳快速释放能量过程中造成的振动，期间会产生地震波的一种自然现象。地球上板块与板块之间相互挤压碰撞，造成板块边沿及板块内部产生错动和破裂，是引起地震的主要原因。 [1] \n" +
                "地震开始发生的地点称为震源，震源正上方的地面称为震中。破坏性地震的地面振动最烈处称为极震区，极震区往往也就是震中所在的地区。 [2]  地震常常造成严重人员伤亡，能引起火灾、水灾、有毒气体泄漏、细菌及放射性物质扩散，还可能造成海啸、滑坡、崩塌、地裂缝等次生灾害。\n" +
                "据统计，地球上每年约发生500多万次地震，即每天要发生上万次的地震。其中绝大多数太小或太远，以至于人们感觉不到；真正能对人类造成严重危害的地震大约有十几二十次；能造成特别严重灾害的地震大约有一两次。人们感觉不到的地震，必须用地震仪才能记录下来；不同类型的地震仪能记录不同强度、不同远近的地震。世界上运转着数以千计的各种地震仪器日夜监测着地震的动向。 [3] \n" +
                "当前的科技水平尚无法预测地震的到来，未来相当长的一段时间内，地震也是无法预测的。所谓成功预测地震的例子，基本都是巧合。对于地震，我们更应该做的是提高建筑抗震等级、做好防御，而不是预测地震。 [4] ");
            alert(" 飓风（拼音：jù fēng，英文：Hurricane），大西洋和东太平洋地区将强大而深厚（最大风速达32.7米/秒，风力为12级以上）的热带气旋称为飓风，也泛指狂风和任何热带气旋以及风力达12级的任何大风。飓风中心有一个风眼，风眼愈小，破坏力愈大 [1]  ，其意义和台风类似，只是产生地点不同。热带气旋（飓风)的形成受到科里奥利力（地球自转）的影响。驱动热带气旋运动的原动力一个低气压中心与周围大气的压力差，周围大气中的空气在压力差的驱动下向低气压中心定向移动，这种移动受到科里奥利力的影响而发生偏转，从而形成旋转的气流，这种旋转在北半球沿着逆时针方向而在南半球沿着顺时针方向，由于旋转的作用，低气压中心得以长时间保持。")
            alert("野火（英文：Wildfire）从 11 月 8 日早上 6 点半被发现开始算起，到 11 月 23 日基本得到控制（95% 的火情得到控制），“营溪大火（Camp Fire）”烧了整整半个月。截止目前，大火一共造成了 84 人死亡，3 名消防员受伤，过火面积超过 62000 公顷，烧毁了超过18000 栋建筑，人员伤亡和财产损失都创加州历史纪录。\n" +
                "\n" +
                "大火可能由一条坏损电线引发，不过加州频繁的火灾并不皆是如此。\n" +
                "\n" +
                "作为全美野火最多的地区，仅在今年，加州就发生了近 60 起过火面积超过 400 公顷、造成明显人员伤亡和建筑损毁的火灾。频繁野火的背后是加州人住的离森林越来越近，而环境在近几十年里变得越来越干燥、高温。\n" +
                "\n" +
                "科罗拉多大学的景观生态学家 Tania Schoennagel 和她的研究团队去年在《美国国家科学院院刊》（Proceedings of the National Academy of Sciences）上发表的一项关于北美野火的研究指出，从 1979 年 - 2013 年里，全球的火灾季节整体延长了 19%，而北美西部则是影响最为明显的地区。从 1985 起，全球超过一半的火灾季节延长发生在美国西部的森林里。\n" +
                "\n" +
                "北美西部的景观在最近几十年发生了缓慢但是显著的变化：气候变暖变干，可供野火燃烧的燃料不断累积，野地-城市交界区不断扩大。与之相伴的结果是，过去三十年里，北美的野火无论是在数量还是规模上都比以前更多、更大，造成的损失也更为严重，而且有随着气候变暖继续加重的趋势。")
         });



        // viewbase1 =new MapView({
        //     map: map1,
        //     center: [114.304,30.613], // Longitude, latitude
        //     zoom: 15, // Zoom level
        //     container: "basemap1" // Div element
        // });
        // viewbase2 =new MapView({
        //     map: map2,
        //     center: [114.304,30.613], // Longitude, latitude
        //     zoom: 15, // Zoom level
        //     container: "basemap2" // Div element
        // });
        // viewbase3 =new MapView({
        //     map: map4,
        //     center: [114.304,30.613], // Longitude, latitude
        //     zoom: 15, // Zoom level
        //     container: "basemap3" // Div element
        // });
        // viewbase1.ui.components=[];
        // viewbase2.ui.components=[];
        // viewbase3.ui.components=[];

        const layer_1 = new MapImageLayer({
            url: "https://sampleserver6.arcgisonline.com/arcgis/rest/services/Earthquakes_Since1970/MapServer"
        });

        const layer_2 = new MapImageLayer({
            url: "https://sampleserver6.arcgisonline.com/arcgis/rest/services/Wildfire/MapServer"
        });
        var layer_3 = new MapImageLayer({
            url: "https://sampleserver6.arcgisonline.com/arcgis/rest/services/Hurricanes/MapServer"
        })
        // map.add(layer_1);
        // map.add(layer_2);
        // map.add(layer_3);
        function showCoordinates(pt) {
            var coords = "经纬度 " + pt.latitude.toFixed(3) + " ," + pt.longitude.toFixed(3) +
                " 比例尺:" + "1/"+Math.round(view.scale ) ;
            scale.innerHTML = coords;
        }
        view.when(function (evt){
            showCoordinates(view.toMap({ x: evt.x, y: evt.y }));
        });
        view.on(["pointer-down","pointer-move"], function(evt) {
            showCoordinates(view.toMap({ x: evt.x, y: evt.y }));
        });

        // var queryURL="https://services.arcgis.com/P3ePLMYs2RVChkJx/ArcGIS/rest/services/CHN_Boundaries_2020/FeatureServer/query?layerDefs=&geometry=&geometryType=esriGeometryEnvelope&inSR=&spatialRel=esriSpatialRelIntersects&outSR=&datumTransformation=&applyVCSProjection=false&returnGeometry=true&maxAllowableOffset=&geometryPrecision=&returnIdsOnly=false&returnCountOnly=false&returnDistinctValues=false&returnZ=false&returnM=false&sqlFormat=none&f=html&token=TOKmSIRV_iknR6yjQ-wg8dxkvetluLZk2Rk3fMpSSsACqohq_JFDZXdHoPML5-eNFteN-97fg7BjLpATlLtIbq1QgP6NH9h3QVwfXN5VcvHZmA_tonTCsThLo8DipRKzmCfDNFCaDT6x-OmeB4GbUZX5-jjkj7teotnB0p3Q3XqEK0TV6TP8AP2AYAY_017HTTS7M8IhtqzEyhy7la3oxJ_RPX-T-ZybB3hvPF2RsEMNCASGC8GQ00dlE8pzYlWHO4jajhiuTU2py4O54qRxVld98tpGpCjevDZF3qX_0ZxHNOApDfOb3Aeqxl5Q8zXQ";
        var queryURL = "https://services.arcgis.com/P3ePLMYs2RVChkJx/ArcGIS/rest/services/CHN_Boundaries_2020/FeatureServer/3/?token=TOKmSIRV_iknR6yjQ-wg8dxkvetluLZk2Rk3fMpSSsACqohq_JFDZXdHoPML5-eNFteN-97fg7BjLpATlLtIbq1QgP6NH9h3QVwfXN5VcvHZmA_tonTCsThLo8DipRKzmCfDNFCaDT6x-OmeB4GbUZX5-jjkj7teotnB0p3Q3XqEK0TV6TP8AP2AYAY_017HTTS7M8IhtqzEyhy7la3oxJ_RPX-T-ZybB3hvPF2RsEMNCASGC8GQ00dlE8pzYlWHO4jajhiuTU2py4O54qRxVld98tpGpCjevDZF3qX_0ZxHNOApDfOb3Aeqxl5Q8zXQ"
        var Gl = new GeoJSONLayer({
            url:"https://cxqttkl.github.io/gis2018/武汉市.json"
        });
        Gl.popupTemplate= new PopupTemplate({
            title:"{name}",
        })
        var qt = new QueryTask({
            url:queryURL
        });
        var q = new Query();
        q.returnGeometry = true;
        q.outFields=["*"];

        q.where =  "NAME = 'Wuchang District'" ;
        view.on("click",function (evt) {
            qt.execute(q).then(function (result) {
                console.log(result)
                var g_wuchang = result.features[0];
                // var symbol1 =
                // SimpleFillSymbol
                g_wuchang.symbol={
                    type: "simple-fill",  // autocasts as new SimpleFillSymbol()
                    color: [ 51,51, 204, 0.5 ],
                    style: "solid",
                    outline: {  // autocasts as new SimpleLineSymbol()
                        color: "white",
                        width: 1
                    }
                };
                console.log(g_wuchang)
                view.graphics.add(g_wuchang);
            })
        })
            map.add(layer_1);
            map.add(layer_2);
            map.add(layer_3);
        // view.map.allLayers.on("change", function(event) {
        //     const num = view.map.allLayers.length;
        //     document.getElementById("Layers").textContent = "图层数： " + num;
        // });
        // var l1 = document.getElementById("addlayer1");
        // l1.addEventListener("click",f1);
        // function f1() {
        //     map.add(layer_1);
        // }
        // var l2 = document.getElementById("addlayer2");
        // l2.addEventListener("click",f2);
        // function f2() {
        //     map.add(layer_2);
        // }
        // var l3 = document.getElementById("addlayer3");
        // l3.addEventListener("click",f3);
        // function f3() {
        //     map.add(layer_3);
        // }
        // var l4 = document.getElementById("removelayer1");
        // l4.addEventListener("click",f4);
        // function f4() {
        //     view.map.remove(layer_1);
        // }
        // var l5 = document.getElementById("removelayer2");
        // l5.addEventListener("click",f5);
        // function f5() {
        //     view.map.remove(layer_2);
        // }
        // var l6 = document.getElementById("removelayer3");
        // l6.addEventListener("click",f6);
        // function f6() {
        //     view.map.remove(layer_3);
        // }
    })


    $("#viewbox").on('mousemove', function (event) {
        var width = $("#viewbox").offset().left;
        var height = $("#viewbox").offset().top;
        console.log(width)
        var t = event.clientX - width;
        document.getElementById("viewDiv3").style.clip = `rect(0, ${t}px , 770px,0)`;
    });


</script>
</body>
</html>